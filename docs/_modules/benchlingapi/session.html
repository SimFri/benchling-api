<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>benchlingapi.session &#8212; benchlingapi 2.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/style.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          BenchlingAPI</a>
        <span class="navbar-text navbar-version pull-left"><b>2.0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">BenchlingAPI <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../session.html">Session (<code class="xref py py-mod docutils literal notranslate"><span class="pre">benchlingapi.session</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models.html">Models (<code class="xref py py-mod docutils literal notranslate"><span class="pre">benchlingapi.models.models</span></code>)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../models.html#models">Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.models.DNASequence.html">benchlingapi.models.models.DNASequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.models.AASequence.html">benchlingapi.models.models.AASequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.models.Oligo.html">benchlingapi.models.models.Oligo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.models.Annotation.html">benchlingapi.models.models.Annotation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.models.Translation.html">benchlingapi.models.models.Translation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.models.CustomEntity.html">benchlingapi.models.models.CustomEntity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.models.EntitySchema.html">benchlingapi.models.models.EntitySchema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.models.Project.html">benchlingapi.models.models.Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.models.Registry.html">benchlingapi.models.models.Registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.models.Translation.html">benchlingapi.models.models.Translation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../models.html#schemas">Schemas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.schema.DNASequenceSchema.html">benchlingapi.models.schema.DNASequenceSchema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.schema.AASequenceSchema.html">benchlingapi.models.schema.AASequenceSchema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.schema.BatchSchema.html">benchlingapi.models.schema.BatchSchema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.schema.CustomEntitySchema.html">benchlingapi.models.schema.CustomEntitySchema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.schema.DNASequenceSchema.html">benchlingapi.models.schema.DNASequenceSchema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.schema.EntitySchema.html">benchlingapi.models.schema.EntitySchema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.schema.EntitySchemaSchema.html">benchlingapi.models.schema.EntitySchemaSchema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.schema.FieldSchema.html">benchlingapi.models.schema.FieldSchema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.schema.FolderSchema.html">benchlingapi.models.schema.FolderSchema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.schema.OligoSchema.html">benchlingapi.models.schema.OligoSchema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.schema.ProjectSchema.html">benchlingapi.models.schema.ProjectSchema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.schema.RegistrySchema.html">benchlingapi.models.schema.RegistrySchema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.schema.TranslationSchema.html">benchlingapi.models.schema.TranslationSchema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/benchlingapi.models.schema.UserSummarySchema.html">benchlingapi.models.schema.UserSummarySchema</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../exceptions.html">Exceptions (<code class="xref py py-mod docutils literal notranslate"><span class="pre">benchlingapi.exceptions</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utils.html">Utilities (<code class="xref py py-mod docutils literal notranslate"><span class="pre">benchlingapi.utils</span></code>)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../usage.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage.html#session">Session</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#finding-models">Finding models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#updating-models">Updating models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#saving-new-models">Saving new models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#registering-models-to-your-registry">Registering models to your registry</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../guidelines.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../guidelines.html#installing-the-package">Installing the package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../guidelines.html#adding-a-new-model">Adding a new model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../guidelines.html#running-tests">Running tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../guidelines.html#style">Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../guidelines.html#release">Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../guidelines.html#documentation">Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/changelog.html">benchlingapi change log</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../developer/changelog.html#id1">2.0.0</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for benchlingapi.session</h1><div class="highlight"><pre>
<span></span>r&quot;&quot;&quot;
Session (:mod:`benchlingapi.session`)
=====================================

.. currentmodule:: benchlingapi.session

Main entrypoint for the benchling api. To open a session,
use your *Benchling-provided API key*. From there, you
can access the session-enabled models:

.. code-block:: python

    from benchlingapi import Session

    session = Session(&quot;asdfe8iunaoerhgoaher&quot;)
    session.DNASequence
    session.AASequence
    session.Oligo
    session.Registry

For more information on the models and their methods, see the
:ref:`API model docs &lt;api_models&gt;`
&quot;&quot;&quot;
from functools import partial
from functools import wraps
from typing import Any
from typing import Generator
from typing import List
from typing import Type

import requests

from benchlingapi.exceptions import BenchlingAPIException
from benchlingapi.exceptions import exception_dispatch
from benchlingapi.exceptions import ModelNotFoundError
from benchlingapi.models.base import ModelBase
from benchlingapi.models.base import ModelRegistry
from benchlingapi.models.models import __all__ as allmodels
from benchlingapi.utils import un_underscore_keys
from benchlingapi.utils import url_build


<div class="viewcode-block" id="RequestDecorator"><a class="viewcode-back" href="../../session.html#benchlingapi.session.RequestDecorator">[docs]</a>class RequestDecorator:
    &quot;&quot;&quot;Wraps a function to raise error with unexpected request status codes.&quot;&quot;&quot;

    def __init__(self, status_codes):
        if not isinstance(status_codes, list):
            status_codes = [status_codes]
        self.code = status_codes

    def __call__(self, f):
        @wraps(f)
        def wrapped_f(*args, **kwargs):
            r = f(*args, **kwargs)
            if r.status_code not in self.code:
                http_codes = {
                    400: &quot;BAD REQUEST&quot;,
                    403: &quot;FORBIDDEN&quot;,
                    404: &quot;NOT FOUND&quot;,
                    500: &quot;INTERNAL SERVER ERROR&quot;,
                    503: &quot;SERVICE UNAVAILABLE&quot;,
                    504: &quot;SERVER TIMEOUT&quot;,
                }
                msg = &quot;&quot;
                if r.status_code in http_codes:
                    msg = http_codes[r.status_code]
                    msg += f&quot;\nrequest: {r.request}&quot;
                    msg += f&quot;\nurl: {r.request.path_url}&quot;
                    msg += f&quot;\nresponse: {r.text}&quot;

                e = BenchlingAPIException(
                    &quot;HTTP Response Failed {} {}&quot;.format(r.status_code, msg)
                )
                e.response = r
                exception_dispatch(e)
            return r.json()

        return wrapped_f</div>


<div class="viewcode-block" id="Http"><a class="viewcode-back" href="../../session.html#benchlingapi.session.Http">[docs]</a>class Http:
    &quot;&quot;&quot;Creates and responds to the Benchling server.&quot;&quot;&quot;

    TIMEOUT = 30
    HOME = &quot;https://benchling.com/api/v2&quot;
    NEXT = &quot;nextToken&quot;

    def __init__(self, api_key):
        session = requests.Session()
        session.auth = (api_key, &quot;&quot;)
        self.__session = session
        self.post = RequestDecorator([200, 201, 202])(partial(self.request, &quot;post&quot;))
        self.get = RequestDecorator(200)(partial(self.request, &quot;get&quot;))
        self.delete = RequestDecorator(200)(partial(self.request, &quot;delete&quot;))
        self.patch = RequestDecorator([200, 201])(partial(self.request, &quot;patch&quot;))

    def request(
        self, method: str, path: str, timeout: int = None, action: str = None, **kwargs
    ) -&gt; Any:

        if &quot;json&quot; in kwargs:
            kwargs[&quot;json&quot;] = un_underscore_keys(kwargs[&quot;json&quot;])
        if &quot;params&quot; in kwargs:
            kwargs[&quot;params&quot;] = un_underscore_keys(kwargs[&quot;params&quot;])

        if timeout is None:
            timeout = self.TIMEOUT
        if action is not None:
            path += &quot;:&quot; + action
        return self.__session.request(
            method, url_build(self.HOME, path), timeout=timeout, **kwargs
        )

    def get_pages(
        self, path: str, timeout: int = None, action: str = None, **kwargs
    ) -&gt; Generator[Any, None, None]:
        get_response = partial(self.get, path, timeout=timeout, action=action)

        response = get_response(**kwargs)

        while response is not None:
            yield response

            next = response.get(self.NEXT, None)
            # update params with nextToken
            params = kwargs.get(self.NEXT, {})
            params.update({self.NEXT: next})
            kwargs[&quot;params&quot;] = params

            if next:
                response = get_response(**kwargs)
            else:
                response = None</div>


<div class="viewcode-block" id="Session"><a class="viewcode-back" href="../../session.html#benchlingapi.session.Session">[docs]</a>class Session:
    &quot;&quot;&quot;The session object.

    This serves as the main interface for using the BenchlingAPI.
    &quot;&quot;&quot;

    def __init__(self, api_key):
        self.__http = Http(api_key)
        self.__interfaces = {}
        for model_name in allmodels:
            model_cls = ModelRegistry.get_model(model_name)
            namespace = {&quot;session&quot;: self}
            mymodel = type(model_name, (model_cls,), namespace)
            setattr(self, model_name, mymodel)
            self.__interfaces[model_name] = mymodel

    @property
    def http(self) -&gt; Http:
        &quot;&quot;&quot;Return the http requester object.&quot;&quot;&quot;
        return self.__http

    @property
    def url(self) -&gt; str:
        &quot;&quot;&quot;Return home benchling url.&quot;&quot;&quot;
        return self.__http.HOME

<div class="viewcode-block" id="Session.help"><a class="viewcode-back" href="../../session.html#benchlingapi.session.Session.help">[docs]</a>    def help(self):
        &quot;&quot;&quot;Print api documentation url.&quot;&quot;&quot;
        help_url = &quot;https://docs.benchling.com/reference&quot;
        print(&#39;Visit &quot;{}&quot;&#39;.format(help_url))</div>

    @property
    def models(self) -&gt; List[str]:
        &quot;&quot;&quot;List all models.&quot;&quot;&quot;
        return list(ModelRegistry.models.keys())

<div class="viewcode-block" id="Session.set_timeout"><a class="viewcode-back" href="../../session.html#benchlingapi.session.Session.set_timeout">[docs]</a>    def set_timeout(self, timeout_in_seconds: int):
        &quot;&quot;&quot;Set the request timeout.&quot;&quot;&quot;
        self.__http.timeout = timeout_in_seconds</div>

    @property
    def interfaces(self):
        &quot;&quot;&quot;List all model interfaces.&quot;&quot;&quot;
        return self.__interfaces

<div class="viewcode-block" id="Session.interface"><a class="viewcode-back" href="../../session.html#benchlingapi.session.Session.interface">[docs]</a>    def interface(self, model_name) -&gt; Type[ModelBase]:
        &quot;&quot;&quot;Return a model interface by name.&quot;&quot;&quot;
        if model_name not in self.interfaces:
            raise ModelNotFoundError(&#39;No model by name of &quot;{}&quot;&#39;.format(model_name))
        return self.interfaces[model_name]</div></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017-2019, University of Washington.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>